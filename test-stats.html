<!DOCTYPE html>
<html>
<head>
    <title>Test User Stats</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>User Stats System Test</h1>
    
    <div class="test-section">
        <h3>Step 1: Run the SQL Fix</h3>
        <p>1. Go to your Supabase Dashboard</p>
        <p>2. Navigate to SQL Editor</p>
        <p>3. Copy and paste the contents of <code>fix-user-stats.sql</code></p>
        <p>4. Click "Run"</p>
    </div>

    <div class="test-section">
        <h3>Step 2: Test Your App</h3>
        <p>1. Refresh your React app</p>
        <p>2. Sign in to your account</p>
        <p>3. Check if the dashboard shows stats (should be 0 for new users)</p>
        <p>4. Try uploading a PDF - total flashcards should increment</p>
        <p>5. Try starting a study session - stats should update</p>
    </div>

    <div class="test-section">
        <h3>Step 3: Check Console for Errors</h3>
        <p>Open browser developer tools (F12) and check the Console tab for any errors.</p>
        <p>Look for messages like:</p>
        <ul>
            <li>✅ "Successfully loaded user stats"</li>
            <li>❌ "Error fetching user stats"</li>
            <li>❌ "Failed to update flashcard count"</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>Common Issues & Solutions</h3>
        
        <h4>Issue: "relation 'user_stats' does not exist"</h4>
        <p><strong>Solution:</strong> The SQL script wasn't run. Make sure to run the <code>fix-user-stats.sql</code> script in Supabase.</p>
        
        <h4>Issue: "permission denied for table user_stats"</h4>
        <p><strong>Solution:</strong> The RLS policies weren't created. Re-run the SQL script.</p>
        
        <h4>Issue: "function increment_total_flashcards does not exist"</h4>
        <p><strong>Solution:</strong> The functions weren't created. The app will fallback to direct updates, but re-run the SQL script for better performance.</p>
        
        <h4>Issue: Stats show as 0 even after uploading PDFs</h4>
        <p><strong>Solution:</strong> Check if the user_stats record was created. You can verify in Supabase by running:</p>
        <pre>SELECT * FROM user_stats WHERE user_id = 'your-user-id';</pre>
    </div>

    <div class="test-section">
        <h3>Manual Verification (Optional)</h3>
        <p>To manually check if everything is working, run this query in Supabase SQL Editor:</p>
        <pre>
SELECT 
    us.*,
    COUNT(f.id) as actual_flashcard_count
FROM user_stats us
LEFT JOIN flashcards f ON f.user_id = us.user_id
GROUP BY us.id, us.user_id, us.total_flashcards, us.studied_today, us.average_score, us.study_streak, us.last_streak_date, us.daily_goal, us.created_at, us.updated_at
ORDER BY us.created_at DESC;
        </pre>
    </div>
</body>
</html>
